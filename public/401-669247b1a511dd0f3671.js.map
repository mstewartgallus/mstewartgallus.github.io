{"version":3,"file":"401-669247b1a511dd0f3671.js","mappings":"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","sources":["webpack://words-to-kick-your-teeth-out/./src/features/util/use-click.js","webpack://words-to-kick-your-teeth-out/./src/features/ui/a-client/use-intersect.js","webpack://words-to-kick-your-teeth-out/./src/features/ui/a-client/index.jsx"],"sourcesContent":["import { useCallback } from \"react\";\nimport { navigate } from \"gatsby\";\n\nconst bubble = e => {\n    while (e && (e.tagName !== 'A' || !e.href)) {\n        e = e.parentElement;\n    }\n    return e;\n};\n\nexport const useClick = () => {\n    return useCallback(async e => {\n        // FIXME check if not my url\n        const { defaultPrevented, target, altKey, metaKey, shiftKey, ctrlKey, button } = e;\n        if (defaultPrevented) {\n            return;\n        }\n        if (button !== 0) {\n            return;\n        }\n\n        if (altKey || metaKey || shiftKey || ctrlKey) {\n            return;\n        }\n\n        e.preventDefault();\n\n        const { href } = bubble(target);\n        const { pathname, search } = new URL(href, window.location);\n\n        const url = pathname + search;\n\n        await navigate(url);\n    }, []);\n};\n","const callbacks = new Map();\n\nconst onObserve = entry => {\n    const { target, isIntersecting, intersectionRatio } = entry;\n\n    const near = isIntersecting || intersectionRatio > 0;\n    callbacks.get(target)(near);\n};\n\nlet prefetcher = null;\nconst getPrefetcher = () => {\n    if (prefetcher) {\n        return prefetcher;\n    }\n    if (!window) {\n        return null;\n    }\n\n    const { IntersectionObserver } = window;\n    if (!IntersectionObserver) {\n        return null;\n    }\n\n    prefetcher = new IntersectionObserver(entries => {\n        for (const entry of entries) {\n            onObserve(entry);\n        }\n    });\n    return prefetcher;\n};\n\nexport const observe = (elem, cb, { signal }) => {\n    const pre = getPrefetcher();\n    if (!pre) {\n        return;\n    }\n\n    let ignore = false;\n    const callback = near => {\n        if (ignore) {\n            return;\n        }\n        cb(near);\n    };\n\n    signal.addEventListener('abort', () => {\n        ignore = true;\n        pre.unobserve(elem);\n        callbacks.delete(elem);\n    }, { passive: true });\n\n    callbacks.set(elem, callback);\n    pre.observe(elem);\n};\n","import {\n    forwardRef,\n    useRef,\n    useCallback,\n    useEffect, useReducer, useTransition\n} from \"react\";\nimport { prefetchPathname, graphql, useStaticQuery } from \"gatsby\";\nimport { useClick } from \"@features/util\";\nimport { observe } from \"./use-intersect\";\n\nconst useSiteMetadataRaw = () => useStaticQuery(graphql`\nquery {\n  site {\n    siteMetadata {\n      siteUrl\n    }\n  }\n}`);\n\nconst initState = {\n    mouseover: false,\n    focus: false,\n    near: false\n};\n\nconst reducer = (state, action) => {\n    switch (action) {\n    case 'near':\n        return { ...state, near: true };\n    case 'far':\n        return { ...state, near: false };\n\n    case 'mouseover':\n        return { ...state, mouseover: true };\n    case 'mouseout':\n        return { ...state, mouseover: false };\n\n    case 'focus':\n        return { ...state, focus: true };\n    case 'blur':\n        return { ...state, focus: false };\n\n    default: return state;\n    }\n};\n\nconst useHover = url => useEffect(() => {\n    if (!url) {\n        return;\n    }\n    window.___loader.hovering(url);\n}, [url]);\n\nconst usePrefetchPathname = url => useEffect(() => {\n    if (!url) {\n        return;\n    }\n    const abort = prefetchPathname(url);\n    return () => abort.abort();\n}, [url]);\n\nconst AClient = ({\n    children,\n    onClick,\n    onFocus, onBlur,\n    onMouseOver, onMouseOut,\n    ...props\n}, ref) => {\n    const metadata = useSiteMetadataRaw();\n\n    const siteUrl = metadata.site.siteMetadata.siteUrl;\n\n    const { origin, pathname, search, hash } = new URL(props.href ?? '', siteUrl);\n    const fail = !props.href || hash || origin !== siteUrl || props.target || props.download;\n    const url = fail ? null : pathname + search;\n\n    const onClickNavigate = useClick();\n\n    const onClickWrapper = useCallback(e => {\n        onClick?.(e);\n        onClickNavigate?.(e);\n    }, [onClick, onClickNavigate]);\n\n\n    // Do this sort of silliness to integrate with React's native\n    // scheduling as much as possible and appropriately idle and not\n    // block threads.\n\n    const [, startTransition] = useTransition();\n    const [{ mouseover, focus, near }, dispatch] = useReducer(reducer, initState);\n\n    const onMouseOverWrapper = useCallback(e => {\n        startTransition(() => dispatch('mouseover'));\n        onMouseOver?.(e);\n    }, [onMouseOver]);\n    const onMouseOutWrapper = useCallback(e => {\n        startTransition(() => dispatch('mouseout'));\n        onMouseOut?.(e);\n    }, [onMouseOut]);\n\n    const onFocusWrapper = useCallback(e => {\n        startTransition(() => dispatch('focus'));\n        onMouseOver?.(e);\n    }, [onMouseOver]);\n    const onBlurWrapper = useCallback(e => {\n        startTransition(() => dispatch('blur'));\n        onMouseOut?.(e);\n    }, [onMouseOut]);\n\n    const prefetchRef = useRef();\n\n    useEffect(() => {\n        const { current } = prefetchRef;\n        if (!current) {\n            return;\n        }\n\n        const abort = new AbortController();\n        const { signal } = abort;\n        observe(current, near => {\n            if (near) {\n                startTransition(() => dispatch('near'));\n            } else {\n                startTransition(() => dispatch('far'));\n            }\n        }, { signal });\n        return () => abort.abort();\n    }, []);\n\n    const hover = mouseover || focus;\n    useHover(hover ? url : null);\n    usePrefetchPathname((near || hover) ? url : null);\n\n    return <a\n               {...props}\n               onClick={onClickWrapper}\n               onMouseOver={onMouseOverWrapper}\n               onMouseOut={onMouseOutWrapper}\n               onFocus={onFocusWrapper}\n               onBlur={onBlurWrapper}\n               ref={elem => {\n                   prefetchRef.current = fail ? null : elem;\n\n                   if (ref) {\n                       ref.current = elem;\n                   }\n               }}>{children}</a>;\n};\n\nconst ARef = forwardRef(AClient);\n\nexport { ARef as AClient, ARef as default };\n"],"names":["callbacks","Map","onObserve","entry","target","isIntersecting","intersectionRatio","near","get","prefetcher","observe","elem","cb","_ref","signal","pre","getPrefetcher","window","IntersectionObserver","entries","ignore","addEventListener","unobserve","delete","passive","set","initState","mouseover","focus","reducer","state","action","AClient","ref","_props$href","children","onClick","onFocus","onBlur","onMouseOver","onMouseOut","props","siteUrl","useStaticQuery","site","siteMetadata","origin","pathname","search","hash","URL","href","fail","download","url","onClickNavigate","useCallback","async","defaultPrevented","altKey","metaKey","shiftKey","ctrlKey","button","e","preventDefault","tagName","parentElement","bubble","location","navigate","onClickWrapper","startTransition","useTransition","dispatch","useReducer","onMouseOverWrapper","onMouseOutWrapper","onFocusWrapper","onBlurWrapper","prefetchRef","useRef","useEffect","current","abort","AbortController","hover","___loader","hovering","useHover","prefetchPathname","usePrefetchPathname","_jsx","ARef","forwardRef"],"sourceRoot":""}