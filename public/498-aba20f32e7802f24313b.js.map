{"version":3,"file":"498-aba20f32e7802f24313b.js","mappings":"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","sources":["webpack://words-to-kick-your-teeth-out/./src/features/ui/a-local/use-intersect.js","webpack://words-to-kick-your-teeth-out/./src/features/ui/a-local/index.jsx"],"sourcesContent":["const callbacks = new Map();\n\nconst onObserve = entry => {\n    const { target, isIntersecting, intersectionRatio } = entry;\n\n    const near = isIntersecting || intersectionRatio > 0;\n    callbacks.get(target)(near);\n};\n\nlet prefetcher = null;\nconst getPrefetcher = () => {\n    if (prefetcher) {\n        return prefetcher;\n    }\n    if (!window) {\n        return null;\n    }\n\n    const { IntersectionObserver } = window;\n    if (!IntersectionObserver) {\n        return null;\n    }\n\n    prefetcher = new IntersectionObserver(entries => {\n        for (const entry of entries) {\n            onObserve(entry);\n        }\n    });\n    return prefetcher;\n};\n\nexport const observe = (elem, cb, { signal }) => {\n    const pre = getPrefetcher();\n    if (!pre) {\n        return;\n    }\n\n    let ignore = false;\n    const callback = near => {\n        if (ignore) {\n            return;\n        }\n        cb(near);\n    };\n\n    signal.addEventListener('abort', () => {\n        ignore = true;\n        pre.unobserve(elem);\n        callbacks.delete(elem);\n    }, { passive: true });\n\n    callbacks.set(elem, callback);\n    pre.observe(elem);\n};\n","import {\n    forwardRef,\n    useRef,\n    useCallback,\n    useEffect, useReducer, useTransition\n} from \"react\";\nimport { prefetchPathname, navigate } from \"gatsby\";\nimport { observe } from \"./use-intersect\";\n\nconst initState = {\n    mouseover: false,\n    focus: false,\n    near: false\n};\n\nconst reducer = (state, action) => {\n    switch (action) {\n    case 'near':\n        return { ...state, near: true };\n    case 'far':\n        return { ...state, near: false };\n\n    case 'mouseover':\n        return { ...state, mouseover: true };\n    case 'mouseout':\n        return { ...state, mouseover: false };\n\n    case 'focus':\n        return { ...state, focus: true };\n    case 'blur':\n        return { ...state, focus: false };\n\n    default: return state;\n    }\n};\n\nconst useHover = url => useEffect(() => {\n    if (!url) {\n        return;\n    }\n    window.___loader.hovering(url);\n}, [url]);\n\nconst usePrefetchPathname = url => useEffect(() => {\n    if (!url) {\n        return;\n    }\n    const abort = prefetchPathname(url);\n    return () => abort.abort();\n}, [url]);\n\nconst AClient = ({\n    children,\n    onClick,\n    onFocus, onBlur,\n    onMouseOver, onMouseOut,\n    ...props\n}, ref) => {\n    const prefetchRef = useRef();\n\n    const { href } = props;\n\n    // Do this sort of silliness to integrate with React's native\n    // scheduling as much as possible and appropriately idle and not\n    // block threads.\n\n    const [, startTransition] = useTransition();\n    const [{ mouseover, focus, near }, dispatch] = useReducer(reducer, initState);\n\n    const onClickWrapper = useCallback(async e => {\n        onClick?.(e);\n        if (e.defaultPrevented) {\n            return;\n        }\n\n        e.preventDefault();\n        await navigate(href);\n    }, [onClick, href]);\n\n    const onMouseOverWrapper = useCallback(e => {\n        startTransition(() => dispatch('mouseover'));\n        onMouseOver?.(e);\n    }, [onMouseOver]);\n    const onMouseOutWrapper = useCallback(e => {\n        startTransition(() => dispatch('mouseout'));\n        onMouseOut?.(e);\n    }, [onMouseOut]);\n\n    const onFocusWrapper = useCallback(e => {\n        startTransition(() => dispatch('focus'));\n        onMouseOver?.(e);\n    }, [onMouseOver]);\n    const onBlurWrapper = useCallback(e => {\n        startTransition(() => dispatch('blur'));\n        onMouseOut?.(e);\n    }, [onMouseOut]);\n\n    useEffect(() => {\n        const { current } = prefetchRef;\n        if (!current) {\n            return;\n        }\n\n        const abort = new AbortController();\n        const { signal } = abort;\n        observe(current, near => {\n            if (near) {\n                startTransition(() => dispatch('near'));\n            } else {\n                startTransition(() => dispatch('far'));\n            }\n        }, { signal });\n        return () => abort.abort();\n    }, []);\n\n    const hover = mouseover || focus;\n    useHover(hover ? href : null);\n    usePrefetchPathname((near || hover) ? href : null);\n\n    return <a\n               {...props}\n               onClick={onClickWrapper}\n               onMouseOver={onMouseOverWrapper}\n               onMouseOut={onMouseOutWrapper}\n               onFocus={onFocusWrapper}\n               onBlur={onBlurWrapper}\n               ref={elem => {\n                   prefetchRef.current = elem;\n                   if (ref) {\n                       ref.current = elem;\n                   }\n               }}>{children}</a>;\n};\n\nconst ARef = forwardRef(AClient);\n\nexport { ARef as AClient, ARef as default };\n"],"names":["callbacks","Map","onObserve","entry","target","isIntersecting","intersectionRatio","near","get","prefetcher","observe","elem","cb","_ref","signal","pre","getPrefetcher","window","IntersectionObserver","entries","ignore","addEventListener","unobserve","delete","passive","set","initState","mouseover","focus","reducer","state","action","AClient","ref","children","onClick","onFocus","onBlur","onMouseOver","onMouseOut","props","prefetchRef","useRef","href","startTransition","useTransition","dispatch","useReducer","onClickWrapper","useCallback","async","e","defaultPrevented","preventDefault","navigate","onMouseOverWrapper","onMouseOutWrapper","onFocusWrapper","onBlurWrapper","useEffect","current","abort","AbortController","hover","url","___loader","hovering","prefetchPathname","usePrefetchPathname","_jsx","ARef","forwardRef"],"sourceRoot":""}