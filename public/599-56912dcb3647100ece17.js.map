{"version":3,"file":"599-56912dcb3647100ece17.js","mappings":"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","sources":["webpack://words-to-kick-your-teeth-out/./src/features/ui/section.jsx","webpack://words-to-kick-your-teeth-out/./src/features/post/comment.jsx","webpack://words-to-kick-your-teeth-out/./src/features/post/comment.module.css","webpack://words-to-kick-your-teeth-out/./src/features/post/comment-list.jsx","webpack://words-to-kick-your-teeth-out/./src/features/post/comment-list.module.css","webpack://words-to-kick-your-teeth-out/./src/features/post/comments.jsx","webpack://words-to-kick-your-teeth-out/./src/features/post/post-comments.jsx"],"sourcesContent":["import { useId } from \"react\";\nimport { Card } from \"./card\";\n\nexport const Section = ({children, heading, ...props}) => {\n    const id = useId();\n    return <section aria-labelledby={id} {...props}>\n               <Card>\n                   <header id={id}>\n                       <hgroup>\n                           {heading}\n                       </hgroup>\n                   </header>\n                   {children}\n               </Card>\n           </section>;\n};\n","import { useMemo, useState, useCallback } from \"react\";\nimport { A } from \"@features/ui\";\nimport {\n    iframe as iframeClass,\n    loaded as loadedClass,\n    unloaded as unloadedClass,\n    comment as commentClass,\n    header as headerClass\n} from \"./comment.module.css\";\n\nconst Account = ({url, display_name, acct}) => {\n    const name = display_name !== '' ? display_name : acct;\n    return <address><A rel=\"nofollow\" href={url}>{name}</A></address>;\n};\n\nconst render = content =>\n      `<!DOCTYPE html>\n<html>\n  <head>\n    <base target=\"_parent\">\n    <meta name=\"color-scheme\" content=\"dark light\">\n    <link rel=\"stylesheet\" href=\"/sandbox.css\">\n  </head>\n  <body>${content}</body>\n</html>`;\n\nconst useRender = content =>\n      useMemo(() => render(content), [content]);\n\nexport const Comment = ({url, account, content, children}) => {\n    const srcdoc = useRender(content);\n\n    const [loaded, setLoaded] = useState(false);\n    const onLoad = useCallback(event => {\n        setLoaded(true);\n    }, []);\n\n    const loadClass = loaded ? loadedClass : unloadedClass;\n\n    return <article className={commentClass}>\n               <header className={headerClass}>\n                   <Account {...account} />\n                   <A rel=\"nofollow\" href={url}>#</A>\n               </header>\n                <iframe className={iframeClass + ' ' + loadClass}\n                        allow=\"\"\n                        sandbox=\"allow-top-navigation-by-user-activation\"\n                        srcDoc={srcdoc}\n                        onLoad={onLoad}\n                />\n               <div>\n                   {children}\n               </div>\n           </article>;\n};\n","// extracted by mini-css-extract-plugin\nexport var comment = \"comment-module--comment--13767\";\nexport var header = \"comment-module--header--3b239\";\nexport var iframe = \"comment-module--iframe--0ce46\";\nexport var loaded = \"comment-module--loaded--961c0\";\nexport var unloaded = \"comment-module--unloaded--35fb3\";","import {\n    list as listClass,\n    item as itemClass,\n} from \"./comment-list.module.css\";\n\nexport const CommentList = ({children}) => {\n    return <div className={listClass}>{children}</div>;\n}\n\nexport const CommentItem = ({children}) => {\n    return <div className={itemClass}>{children}</div>;\n}\n","// extracted by mini-css-extract-plugin\nexport var item = \"comment-list-module--item--9f430\";\nexport var list = \"comment-list-module--list--556f9\";","import { useState, useEffect } from \"react\";\nimport { Comment } from \"./comment.jsx\";\nimport { CommentList, CommentItem } from \"./comment-list.jsx\";\n\nconst parseComment = ({id, url, content, account }) => [id, { url, account, content }];\n\nconst parseComments = comments => {\n    if (!comments) {\n        return null;\n    }\n    return new Map(comments.map(parseComment));\n};\n\nconst parseChildren = comments => {\n    if (!comments) {\n        return null;\n    }\n    // group by in_reply_to_id\n    const map = new Map(comments.map(c => [c.in_reply_to_id, []]));\n    for (const {in_reply_to_id, id} of comments) {\n        map.get(in_reply_to_id).push(id);\n    }\n    return map;\n};\n\nconst zipComments = ({id, comments, replies}) => {\n    function loop(id) {\n        const comment = comments.get(id);\n        const allReplies = replies.get(id) ?? [];\n\n        return { id, ...comment, replies: allReplies.map(loop) };\n    }\n\n    return (replies.get(id) ?? []).map(loop);\n};\n\n\nfunction CommentTree({id, account, url, content, replies}) {\n    return <Comment account={account} url={url} content={content}>\n               <CommentList>\n                   {\n\n                       replies.map(comment =>\n                           <CommentItem key={comment.id}>\n                               <CommentTree {...comment} />\n                           </CommentItem>\n                       )\n                   }\n               </CommentList>\n           </Comment>;\n}\n\n\nexport const Comments = ({ host, id }) => {\n    const [comments, setComments] = useState(null);\n\n    useEffect(() => {\n        let ignore = false;\n\n        (async () => {\n            const request = new Request(new URL(`/api/v1/statuses/${id}/context`, `https://${host}`));\n            const response = await fetch(request);\n            if (!response.ok) {\n                throw new Error(`${response.status} ${response.statusText}`);\n            }\n            if (ignore) {\n                return;\n            }\n\n            const json = await response.json();\n            if (ignore) {\n                return;\n            }\n\n            const comments = json?.descendants ?? null;\n\n            const data = parseComments(comments);\n            const replies = parseChildren(comments);\n\n            const zipped = zipComments({ id, comments: data, replies });\n\n            setComments(zipped);\n        })();\n\n        return () => ignore = true;\n    }, [host, id]);\n\n    if (!comments) {\n        return \"Loading...\";\n    }\n\n    return <CommentList>\n               {\n                   comments.map(comment =>\n                       <CommentItem key={comment.id}>\n                           <CommentTree {...comment} />\n                       </CommentItem>)\n               }\n           </CommentList>;\n};\n","import { H2A, Section } from \"@features/ui\";\nimport { Comments } from \"./comments.jsx\";\n\nconst PostComments = ({ host, id }) =>\n<Section heading={\n             <H2A id=\"comments\">Comments</H2A>\n         }>\n    <Comments host={host} id={id} />\n</Section>;\n\nexport default PostComments;\n"],"names":["Section","_ref","children","heading","props","id","useId","_jsx","_jsxs","Card","Account","url","display_name","acct","name","A","rel","href","Comment","_ref2","account","content","srcdoc","useMemo","render","useRender","loaded","setLoaded","useState","onLoad","useCallback","event","loadClass","className","iframeClass","allow","sandbox","srcDoc","CommentList","CommentItem","parseComment","CommentTree","_ref3","replies","map","comment","Comments","_ref4","host","comments","setComments","useEffect","ignore","_json$descendants","request","Request","URL","response","fetch","ok","Error","status","statusText","json","descendants","data","Map","parseComments","c","in_reply_to_id","get","push","parseChildren","zipped","_replies$get2","loop","_replies$get","zipComments","H2A"],"sourceRoot":""}