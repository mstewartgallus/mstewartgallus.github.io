{"version":3,"file":"896-879dde2e7abc1b6ae708.js","mappings":"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","sources":["webpack://words-to-kick-your-teeth-out/./src/features/util/use-click.js","webpack://words-to-kick-your-teeth-out/./src/features/ui/a-client/use-prefetch.js","webpack://words-to-kick-your-teeth-out/./src/features/ui/a-client/index.jsx","webpack://words-to-kick-your-teeth-out/./src/features/ui/a-client/use-hover.js"],"sourcesContent":["import { useCallback } from \"react\";\nimport { navigate } from \"gatsby\";\n\nconst bubble = e => {\n    while (e && (e.tagName !== 'A' || !e.href)) {\n        e = e.parentElement;\n    }\n    return e;\n};\n\nexport const useClick = () => {\n    return useCallback(async e => {\n        // FIXME check if not my url\n        const { target, altKey, metaKey, shiftKey, ctrlKey, button } = e;\n        if (button !== 0) {\n            return;\n        }\n\n        if (altKey || metaKey || shiftKey || ctrlKey) {\n            return;\n        }\n\n        e.preventDefault();\n\n        const { href } = bubble(target);\n        const { pathname, search } = new URL(href, window.location);\n\n        const url = pathname + search;\n\n        await navigate(url);\n    }, []);\n};\n","import { useRef, useEffect } from \"react\";\nimport { prefetchPathname } from \"gatsby\";\n\nconst aborts = new WeakMap();\nconst urls = new WeakMap();\n\n// We need to use idle callbacks somewhwere because rather a lot of\n// links can suddenly appear when opening and closing disclosures and\n// accordions.  Otherwise we can lag animations here.\n\nconst idle = cb => {\n    if (window.requestIdleCallback) {\n        window.requestIdleCallback(cb, { timeout: 500 });\n    } else {\n        window.setTImeout(cb, 0);\n    }\n};\nconst prefetch = elem => {\n    const url = urls.get(elem);\n    if (!url) {\n        return;\n    }\n    const aborter = prefetchPathname(url);\n    aborts.set(elem, aborter);\n};\n\nconst abort = elem => {\n    const aborter = aborts.get(elem);\n    if (!aborter) {\n        return;\n    }\n\n    aborts.delete(elem);\n    aborter.abort();\n};\n\nconst onObserve = entry => {\n    const { target, isIntersecting, intersectionRatio } = entry;\n\n    const near = isIntersecting || intersectionRatio > 0;\n    if (near) {\n        prefetch(target);\n    } else {\n        abort(target);\n    }\n};\n\nlet prefetcher = null;\nconst getPrefetcher = () => {\n    if (prefetcher) {\n        return prefetcher;\n    }\n    if (!window) {\n        return null;\n    }\n\n    const { IntersectionObserver } = window;\n    if (!IntersectionObserver) {\n        return null;\n    }\n\n    prefetcher = new IntersectionObserver(entries => idle(() => {\n        for (const entry of entries) {\n            onObserve(entry);\n        }\n    }));\n    return prefetcher;\n};\n\nconst addPrefetch = (elem, url, { signal }) => {\n    const pre = getPrefetcher();\n    if (!pre) {\n        return;\n    }\n\n    signal.addEventListener('abort', () => {\n        pre.unobserve(elem);\n        urls.delete(elem);\n    }, { passive: true });\n    urls.set(elem, url);\n    pre.observe(elem);\n};\n\n// FIXME move wrapper elsewhere\nexport const usePrefetch = url => {\n    const ref = useRef();\n    useEffect(() => {\n        const { current } = ref;\n        if (!current) {\n            return;\n        }\n\n        const abort = new AbortController();\n        const { signal } = abort;\n        addPrefetch(current, url, { signal });\n        return () => abort.abort();\n    }, [url]);\n    return ref;\n};\n","import { forwardRef } from \"react\";\nimport { graphql, useStaticQuery } from \"gatsby\";\nimport { useClick } from \"@features/util\";\nimport { usePrefetch } from \"./use-prefetch\";\nimport { useHover } from \"./use-hover\";\n\nconst useSiteMetadataRaw = () => useStaticQuery(graphql`\nquery {\n  site {\n    siteMetadata {\n      siteUrl\n    }\n  }\n}`);\n\nconst AClient = ({children, ...props}, ref) => {\n    const metadata = useSiteMetadataRaw();\n\n    const siteUrl = metadata.site.siteMetadata.siteUrl;\n\n    const { origin, pathname, search, hash } = new URL(props.href ?? '', siteUrl);\n    const fail = !props.href || hash || origin !== siteUrl || props.target || props.download;\n    const url = pathname + search;\n\n    const prefetchRef = usePrefetch(url);\n    const hoverRef = useHover(url);\n\n    const onClick = useClick();\n\n    return <a onClick={fail ? null : onClick}\n              {...props}\n              ref={elem => {\n                  hoverRef.current = fail ? null : elem;\n                  prefetchRef.current = fail ? null : elem;\n\n                  if (ref) {\n                      ref.current = elem;\n                  }\n              }}>{children}</a>;\n};\n\nconst ARef = forwardRef(AClient);\n\nexport { ARef as AClient, ARef as default };\n","import { useRef, useEffect } from \"react\";\n\nexport const useHover = url => {\n    const ref = useRef();\n    useEffect(() => {\n        const { current } = ref;\n        if (!current) {\n            return;\n        }\n\n        // FIXME shouldn't bypass stuff\n        const abort = new AbortController();\n        const { signal } = abort;\n        current.addEventListener('mouseenter',\n                                 () => window.___loader.hovering(url),\n                                 { passive: true, signal });\n        return () => abort.abort();\n    }, [url]);\n    return ref;\n};\n"],"names":["aborts","WeakMap","urls","onObserve","entry","target","isIntersecting","intersectionRatio","elem","url","get","aborter","prefetchPathname","set","prefetch","delete","abort","prefetcher","getPrefetcher","window","IntersectionObserver","entries","idle","cb","requestIdleCallback","timeout","setTImeout","usePrefetch","ref","useRef","useEffect","current","AbortController","signal","addPrefetch","_ref","pre","addEventListener","unobserve","passive","observe","AClient","_props$href","children","props","siteUrl","useStaticQuery","site","siteMetadata","origin","pathname","search","hash","URL","href","fail","download","prefetchRef","hoverRef","___loader","hovering","useHover","onClick","useCallback","async","altKey","metaKey","shiftKey","ctrlKey","button","e","preventDefault","tagName","parentElement","bubble","location","navigate","_jsx","ARef","forwardRef"],"sourceRoot":""}