{"version":3,"file":"110-0c790f8f1a2fedf17f44.js","mappings":"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","sources":["webpack://words-to-kick-your-teeth-out/./src/features/ui/a-client/index.jsx"],"sourcesContent":["import { useRef, useEffect, forwardRef } from \"react\";\nimport { graphql, useStaticQuery, prefetchPathname, navigate } from \"gatsby\";\n\nconst useSiteMetadataRaw = () => useStaticQuery(graphql`\nquery {\n  site {\n    siteMetadata {\n      siteUrl\n    }\n  }\n}`);\n\nconst fallback = (siteUrl, props) => {\n    if (!props.href) {\n        return true;\n    }\n\n    const { origin, hash } = new URL(props.href, siteUrl);\n    return hash || origin !== siteUrl || props.target || props.download;\n};\n\nconst aborts = new WeakMap();\n\nconst prefetch = elem => {\n    const { pathname, search } = new URL(elem.href, window.location);\n\n    const url = pathname + search;\n    aborts.set(elem, prefetchPathname(url));\n};\n\nconst abort = elem => {\n    aborts.get(elem)?.abort();\n    aborts.delete(elem);\n};\n\nconst onObserve = entry => {\n    const { target, isIntersecting, intersectionRatio } = entry;\n\n    const near = isIntersecting || intersectionRatio > 0;\n    if (near) {\n        prefetch(target);\n    } else {\n        abort(target);\n    }\n};\n\nlet prefetcher = null;\nconst getPrefetcher = () => {\n    if (prefetcher) {\n        return prefetcher;\n    }\n    if (!window) {\n        return null;\n    }\n\n    const { IntersectionObserver} = window;\n    if (!IntersectionObserver) {\n        return null;\n    }\n\n    prefetcher = new IntersectionObserver(entries => {\n        for (const entry of entries) {\n            onObserve(entry);\n        }\n    });\n    return prefetcher;\n};\n\nconst bubble = e => {\n    while (e && (e.tagName !== 'A' || !e.href)) {\n        e = e.parentElement;\n    }\n    return e;\n};\n\nconst onClick = async e => {\n    const { target, altKey, metaKey, shiftKey, ctrlKey, button } = e;\n    if (button !== 0) {\n        return;\n    }\n\n    if (altKey || metaKey || shiftKey || ctrlKey) {\n        return;\n    }\n\n    e.preventDefault();\n\n    const { href } = bubble(target);\n    const { pathname, search } = new URL(href, window.location);\n\n    const url = pathname + search;\n\n    await navigate(url);\n};\n\nconst onMouseEnter = e => {\n    const { target } = e;\n    const { href } = bubble(target);\n    const { pathname, search } = new URL(href, window.location);\n    // FIXME\n    window.___loader.hovering(pathname + search);\n};\n\nconst AClient = ({children, ...props}, ref) => {\n    const theRef = useRef();\n    ref ??= theRef;\n\n    const metadata = useSiteMetadataRaw();\n\n    const siteUrl = metadata.site.siteMetadata.siteUrl;\n\n    const fail = fallback(siteUrl, props);\n\n    useEffect(() => {\n        if (fail) {\n            return;\n        }\n\n        const pre = getPrefetcher();\n        if (!pre) {\n            return;\n        }\n\n        const { current } = ref;\n        if (!current) {\n            return;\n        }\n        pre.observe(current);\n        return () => pre.unobserve(current);\n    }, [ref, fail]);\n\n    useEffect(() => {\n        if (fail) {\n            return;\n        }\n\n        const { current } = ref;\n        if (!current) {\n            return;\n        }\n\n        const abort = new AbortController();\n        const { signal } = abort;\n        current.addEventListener('mouseenter',\n                                 onMouseEnter,\n                                 { passive: true, signal } );\n        return () => abort.abort();\n    }, [ref, fail]);\n\n    return <a onClick={fail ? null : onClick}\n              {...props}\n              ref={ref}>{children}</a>;\n};\n\nconst ARef = forwardRef(AClient);\n\nexport { ARef as AClient, ARef as default };\n"],"names":["aborts","WeakMap","onObserve","entry","target","isIntersecting","intersectionRatio","elem","_aborts$get","pathname","search","URL","href","window","location","url","set","prefetchPathname","prefetch","get","abort","delete","prefetcher","bubble","e","tagName","parentElement","onClick","async","altKey","metaKey","shiftKey","ctrlKey","button","preventDefault","navigate","onMouseEnter","___loader","hovering","AClient","_ref","ref","_ref2","children","props","theRef","useRef","fail","fallback","siteUrl","origin","hash","download","useStaticQuery","site","siteMetadata","useEffect","pre","getPrefetcher","IntersectionObserver","entries","current","observe","unobserve","AbortController","signal","addEventListener","passive","_jsx","ARef","forwardRef"],"sourceRoot":""}