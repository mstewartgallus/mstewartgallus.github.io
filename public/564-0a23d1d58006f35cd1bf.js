"use strict";(self.webpackChunkwords_to_kick_your_teeth_out=self.webpackChunkwords_to_kick_your_teeth_out||[]).push([[564],{3658:function(e,t,n){n.r(t),n.d(t,{CommentsClient:function(){return CommentsClient},default:function(){return s}});var l=n(7294),o=n(7410),r=n(5893);const Account=e=>{let{url:t,display_name:n,acct:l}=e;const s=""!==n?n:l;return(0,r.jsx)("address",{children:(0,r.jsx)(o.A,{rel:"nofollow",href:t,children:s})})};var post_comment=e=>{let{url:t,account:n,content:s,children:c}=e;const a=(e=>(0,l.useMemo)((()=>(e=>'<!DOCTYPE html>\n<html>\n  <head>\n    <base target="_parent">\n    <meta name="color-scheme" content="dark light">\n    <link rel="stylesheet" href="/sandbox.css">\n  </head>\n  <body>'+e+"</body>\n</html>")(e)),[e]))(s),{0:i,1:u}=(0,l.useState)(!1),d=(0,l.useCallback)((e=>{u(!0)}),[]),m=i?"comment-module--loaded--961c0":"comment-module--unloaded--35fb3";return(0,r.jsxs)("article",{className:"comment-module--comment--13767",children:[(0,r.jsxs)("header",{className:"comment-module--header--3b239",children:[(0,r.jsx)(Account,{...n}),(0,r.jsx)(o.A,{rel:"nofollow",href:t,children:"#"})]}),(0,r.jsx)("iframe",{className:"comment-module--iframe--0ce46 "+m,allow:"",sandbox:"allow-top-navigation-by-user-activation",srcDoc:a,onLoad:d}),(0,r.jsx)("div",{children:c})]})};const CommentList=e=>{let{children:t}=e;return(0,r.jsx)("div",{className:"comment-list-module--list--556f9",children:t})},CommentItem=e=>{let{children:t}=e;return(0,r.jsx)("div",{className:"comment-list-module--item--9f430",children:t})},parseComment=e=>{let{id:t,url:n,content:l,account:o}=e;return[t,{url:n,account:o,content:l}]};function CommentTree(e){let{id:t,account:n,url:l,content:o,replies:s}=e;return(0,r.jsx)(post_comment,{account:n,url:l,content:o,children:(0,r.jsx)(CommentList,{children:s.map((e=>(0,r.jsx)(CommentItem,{children:(0,r.jsx)(CommentTree,{...e})},e.id)))})})}const CommentsClient=e=>{let{host:t,id:n}=e;const{0:o,1:s}=(0,l.useState)(null);return(0,l.useEffect)((()=>{let e=!1;return(async()=>{var l;const o=new Request(new URL("/api/v1/statuses/"+n+"/context","https://"+t)),r=await fetch(o);if(!r.ok)throw new Error(r.status+" "+r.statusText);if(e)return;const c=await r.json();if(e)return;const a=null!==(l=null==c?void 0:c.descendants)&&void 0!==l?l:null,i=(e=>e?new Map(e.map(parseComment)):null)(a),u=(e=>{if(!e)return null;const t=new Map(e.map((e=>[e.in_reply_to_id,[]])));for(const{in_reply_to_id:n,id:l}of e)t.get(n).push(l);return t})(a),d=(e=>{var t;let{id:n,comments:l,replies:o}=e;return(null!==(t=o.get(n))&&void 0!==t?t:[]).map((function loop(e){var t;return{id:e,...l.get(e),replies:(null!==(t=o.get(e))&&void 0!==t?t:[]).map(loop)}}))})({id:n,comments:i,replies:u});s(d)})(),()=>e=!0}),[t,n]),o?(0,r.jsx)(CommentList,{children:o.map((e=>(0,r.jsx)(CommentItem,{children:(0,r.jsx)(CommentTree,{...e})},e.id)))}):"Loading..."};var s=CommentsClient}}]);
//# sourceMappingURL=564-0a23d1d58006f35cd1bf.js.map