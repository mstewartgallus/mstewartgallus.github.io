{"version":3,"file":"547-d589f97a2d5402459362.js","mappings":"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","sources":["webpack://words-to-kick-your-teeth-out/./src/features/ui/a-local/use-hover.js","webpack://words-to-kick-your-teeth-out/./src/features/ui/a-local/use-intersect.js","webpack://words-to-kick-your-teeth-out/./src/features/ui/a-local/index.jsx","webpack://words-to-kick-your-teeth-out/./src/features/ui/a-local/use-prefetch-pathname.js"],"sourcesContent":["import { useEffect } from \"react\";\n\nexport const useHover = url => useEffect(() => {\n    if (!url) {\n        return;\n    }\n    window.___loader.hovering(url);\n}, [url]);\n","const callbacks = new Map();\n\nconst onObserve = entry => {\n    const { target } = entry;\n    const cb = callbacks.get(target);\n    if (!cb) {\n        return;\n    }\n\n    const { isIntersecting, intersectionRatio } = entry;\n    cb(isIntersecting || intersectionRatio > 0);\n};\n\nconst observer = entries => {\n    for (const entry of entries) {\n        onObserve(entry);\n    }\n};\n\nlet prefetcher = null;\nconst getPrefetcher = () => {\n    if (prefetcher) {\n        return prefetcher;\n    }\n    if (!window) {\n        return null;\n    }\n\n    const { IntersectionObserver } = window;\n    if (!IntersectionObserver) {\n        return null;\n    }\n\n    prefetcher = new IntersectionObserver(observer);\n    return prefetcher;\n};\n\nexport const observe = (elem, cb, { signal }) => {\n    const pre = getPrefetcher();\n    if (!pre) {\n        return;\n    }\n\n    let ignore = false;\n    const callback = near => {\n        if (ignore) {\n            return;\n        }\n        cb(near);\n    };\n\n    signal.addEventListener('abort', () => {\n        ignore = true;\n        pre.unobserve(elem);\n        callbacks.delete(elem);\n    }, { passive: true });\n\n    callbacks.set(elem, callback);\n    pre.observe(elem);\n};\n","import {\n    forwardRef,\n    useRef,\n    useCallback,\n    useEffect, useReducer, useTransition\n} from \"react\";\nimport { navigate } from \"gatsby\";\nimport { useHover } from \"./use-hover\";\nimport { usePrefetchPathname } from \"./use-prefetch-pathname\";\nimport { observe } from \"./use-intersect\";\n\nconst initState = {\n    mouseover: false,\n    focus: false,\n    near: false\n};\n\nconst reducer = (state, action) => {\n    switch (action) {\n    case 'near':\n        return { ...state, near: true };\n    case 'far':\n        return { ...state, near: false };\n\n    case 'mouseover':\n        return { ...state, mouseover: true };\n    case 'mouseout':\n        return { ...state, mouseover: false };\n\n    case 'focus':\n        return { ...state, focus: true };\n    case 'blur':\n        return { ...state, focus: false };\n\n    default: return state;\n    }\n};\n\nconst ALocal = (props, ref) => {\n    const {\n        onClick,\n        onFocus, onBlur,\n        onMouseOver, onMouseOut\n    } = props;\n    const prefetchRef = useRef();\n\n    const { href } = props;\n\n    // Do this sort of silliness to integrate with React's native\n    // scheduling as much as possible and appropriately idle and not\n    // block threads.\n\n    const [, startTransition] = useTransition();\n    const [{ mouseover, focus, near }, dispatch] = useReducer(reducer, initState);\n\n    const onClickWrapper = useCallback(async e => {\n        onClick?.(e);\n\n        const { defaultPrevented, target, altKey, metaKey, shiftKey, ctrlKey, button } = e;\n        if (defaultPrevented) {\n            return;\n        }\n        if (button !== 0) {\n            return;\n        }\n\n        if (altKey || metaKey || shiftKey || ctrlKey) {\n            return;\n        }\n\n        e.preventDefault();\n        await navigate(href);\n    }, [onClick, href]);\n\n    const onMouseOverWrapper = useCallback(e => {\n        startTransition(() => dispatch('mouseover'));\n        onMouseOver?.(e);\n    }, [onMouseOver]);\n    const onMouseOutWrapper = useCallback(e => {\n        startTransition(() => dispatch('mouseout'));\n        onMouseOut?.(e);\n    }, [onMouseOut]);\n\n    const onFocusWrapper = useCallback(e => {\n        startTransition(() => dispatch('focus'));\n        onFocus?.(e);\n    }, [onFocus]);\n    const onBlurWrapper = useCallback(e => {\n        startTransition(() => dispatch('blur'));\n        onBlur?.(e);\n    }, [onBlur]);\n\n    useEffect(() => {\n        const { current } = prefetchRef;\n        if (!current) {\n            return;\n        }\n\n        const abort = new AbortController();\n        const { signal } = abort;\n        observe(current, near => {\n            startTransition(() => {\n                if (near) {\n                    dispatch('near');\n                } else {\n                    dispatch('far');\n                }\n            });\n        }, { signal });\n        return () => abort.abort();\n    }, []);\n\n    const hover = mouseover || focus;\n    useHover(hover ? href : null);\n    usePrefetchPathname((near || hover) ? href : null);\n\n    return <a\n               {...props}\n               onClick={onClickWrapper}\n               onMouseOver={onMouseOverWrapper}\n               onMouseOut={onMouseOutWrapper}\n               onFocus={onFocusWrapper}\n               onBlur={onBlurWrapper}\n               ref={elem => {\n                   prefetchRef.current = elem;\n                   if (ref) {\n                       ref.current = elem;\n                   }\n               }}\n           />;\n};\n\nconst ARef = forwardRef(ALocal);\n\nexport { ARef as ALocal, ARef as default };\n","import { useEffect } from \"react\";\nimport { prefetchPathname } from \"gatsby\";\n\nexport const usePrefetchPathname = url => useEffect(() => {\n    if (!url) {\n        return;\n    }\n    const abort = prefetchPathname(url);\n    return () => abort.abort();\n}, [url]);\n"],"names":["callbacks","Map","onObserve","entry","target","cb","get","isIntersecting","intersectionRatio","observer","entries","prefetcher","observe","elem","_ref","signal","pre","getPrefetcher","window","IntersectionObserver","ignore","addEventListener","unobserve","delete","passive","set","near","initState","mouseover","focus","reducer","state","action","ALocal","props","ref","onClick","onFocus","onBlur","onMouseOver","onMouseOut","prefetchRef","useRef","href","startTransition","useTransition","dispatch","useReducer","onClickWrapper","useCallback","async","e","defaultPrevented","altKey","metaKey","shiftKey","ctrlKey","button","preventDefault","navigate","onMouseOverWrapper","onMouseOutWrapper","onFocusWrapper","onBlurWrapper","useEffect","current","abort","AbortController","hover","url","___loader","hovering","prefetchPathname","usePrefetchPathname","_jsx","ARef","forwardRef"],"sourceRoot":""}