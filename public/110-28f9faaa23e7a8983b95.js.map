{"version":3,"file":"110-28f9faaa23e7a8983b95.js","mappings":"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","sources":["webpack://words-to-kick-your-teeth-out/./src/features/ui/a-client/index.jsx"],"sourcesContent":["import { useRef, useEffect, forwardRef } from \"react\";\nimport { graphql, useStaticQuery, prefetchPathname, navigate } from \"gatsby\";\n\nconst useSiteMetadataRaw = () => useStaticQuery(graphql`\nquery {\n  site {\n    siteMetadata {\n      siteUrl\n    }\n  }\n}`);\n\nconst aborts = new WeakMap();\nconst urls = new WeakMap();\n\nconst prefetch = elem => {\n    const url = urls.get(elem);\n    aborts.set(elem, prefetchPathname(url));\n};\n\nconst abort = elem => {\n    aborts.get(elem)?.abort();\n    aborts.delete(elem);\n};\n\nconst onObserve = entry => {\n    const { target, isIntersecting, intersectionRatio } = entry;\n\n    const near = isIntersecting || intersectionRatio > 0;\n    if (near) {\n        prefetch(target);\n    } else {\n        abort(target);\n    }\n};\n\nlet prefetcher = null;\nconst getPrefetcher = () => {\n    if (prefetcher) {\n        return prefetcher;\n    }\n    if (!window) {\n        return null;\n    }\n\n    const { IntersectionObserver} = window;\n    if (!IntersectionObserver) {\n        return null;\n    }\n\n    prefetcher = new IntersectionObserver(entries => {\n        for (const entry of entries) {\n            onObserve(entry);\n        }\n    });\n    return prefetcher;\n};\n\nconst bubble = e => {\n    while (e && (e.tagName !== 'A' || !e.href)) {\n        e = e.parentElement;\n    }\n    return e;\n};\n\nconst onClick = async e => {\n    const { target, altKey, metaKey, shiftKey, ctrlKey, button } = e;\n    if (button !== 0) {\n        return;\n    }\n\n    if (altKey || metaKey || shiftKey || ctrlKey) {\n        return;\n    }\n\n    e.preventDefault();\n\n    const { href } = bubble(target);\n    const { pathname, search } = new URL(href, window.location);\n\n    const url = pathname + search;\n\n    await navigate(url);\n};\n\nconst usePrefetch = url => {\n    const ref = useRef();\n    useEffect(() => {\n        const pre = getPrefetcher();\n        if (!pre) {\n            return;\n        }\n\n        const { current } = ref;\n        if (!current) {\n            return;\n        }\n\n        urls.set(current, url);\n        pre.observe(current);\n        return () => {\n            pre.unobserve(current);\n            urls.delete(current);\n        };\n    }, [url]);\n    return ref;\n};\n\nconst useHover = url => {\n    const ref = useRef();\n    useEffect(() => {\n        const { current } = ref;\n        if (!current) {\n            return;\n        }\n\n        // FIXME shouldn't bypass stuff\n        const abort = new AbortController();\n        const { signal } = abort;\n        current.addEventListener('mouseenter',\n                                 () => window.___loader.hovering(url),\n                                 { passive: true, signal });\n        return () => abort.abort();\n    }, [url]);\n    return ref;\n};\n\nconst AClient = ({children, ...props}, ref) => {\n    const metadata = useSiteMetadataRaw();\n\n    const siteUrl = metadata.site.siteMetadata.siteUrl;\n\n    const { origin, pathname, search, hash } = new URL(props.href ?? '', siteUrl);\n    const fail = !props.href || hash || origin !== siteUrl || props.target || props.download;\n    const url = pathname + search;\n\n    const prefetchRef = usePrefetch(url);\n    const hoverRef = useHover(url);\n\n    return <a onClick={fail ? null : onClick}\n              {...props}\n              ref={elem => {\n                  hoverRef.current = fail ? null : elem;\n                  prefetchRef.current = fail ? null : elem;\n\n                  if (ref) {\n                      ref.current = elem;\n                  }\n              }}>{children}</a>;\n};\n\nconst ARef = forwardRef(AClient);\n\nexport { ARef as AClient, ARef as default };\n"],"names":["aborts","WeakMap","urls","onObserve","entry","target","isIntersecting","intersectionRatio","elem","_aborts$get","url","get","set","prefetchPathname","prefetch","abort","delete","prefetcher","onClick","async","altKey","metaKey","shiftKey","ctrlKey","button","e","preventDefault","href","tagName","parentElement","bubble","pathname","search","URL","window","location","navigate","usePrefetch","ref","useRef","useEffect","pre","getPrefetcher","IntersectionObserver","entries","current","observe","unobserve","AClient","_ref","_props$href","children","props","siteUrl","useStaticQuery","site","siteMetadata","origin","hash","fail","download","prefetchRef","hoverRef","AbortController","signal","addEventListener","___loader","hovering","passive","useHover","_jsx","ARef","forwardRef"],"sourceRoot":""}