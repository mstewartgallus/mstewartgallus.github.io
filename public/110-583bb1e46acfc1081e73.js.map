{"version":3,"file":"110-583bb1e46acfc1081e73.js","mappings":"qQAIA,MAkBMA,EAAS,IAAIC,QAEbC,EAAWC,IACb,MAAM,SAAEC,EAAQ,OAAEC,GAAW,IAAIC,IAAIH,EAAKI,KAAMC,OAAOC,UAEjDC,EAAMN,EAAWC,EACvBL,EAAOW,IAAIR,GAAMS,EAAAA,EAAAA,IAAiBF,GAAK,EAQ3C,IAAIG,EAAa,KACjB,MA4BMC,EAASC,IACX,KAAOA,IAAoB,MAAdA,EAAEC,UAAoBD,EAAER,OACjCQ,EAAIA,EAAEE,cAEV,OAAOF,CAAC,EAGNG,EAAUC,UACZ,IAAIC,EAAAA,EAAAA,MACA,OAGJ,MAAM,OAAEC,EAAM,OAAEC,EAAM,QAAEC,EAAO,SAAEC,EAAQ,QAAEC,EAAO,OAAEC,GAAWX,EAC/D,GAAe,IAAXW,EACA,OAGJ,GAAIJ,GAAUC,GAAWC,GAAYC,EACjC,OAGJV,EAAEY,iBAEF,MAAM,KAAEpB,GAASO,EAAOO,IAClB,SAAEjB,EAAQ,OAAEC,GAAW,IAAIC,IAAIC,EAAMC,OAAOC,UAE5CC,EAAMN,EAAWC,QAEjBuB,EAAAA,EAAAA,IAASlB,EAAI,EAGjBmB,EAAed,IACjB,MAAM,OAAEM,GAAWN,GACb,KAAER,GAASO,EAAOO,IAClB,SAAEjB,EAAQ,OAAEC,GAAW,IAAIC,IAAIC,EAAMC,OAAOC,UAElDD,OAAOsB,UAAUC,SAAS3B,EAAWC,EAAO,EAG1C2B,EAAUA,CAAAC,EAAuBC,KAAS,IAADC,EAAA,IAA9B,SAACC,KAAaC,GAAMJ,EACjC,MAAMK,GAASC,EAAAA,EAAAA,UACZ,QAAHJ,EAAAD,SAAG,IAAAC,IAAHD,EAAQI,GAER,MAEME,GA1GuBC,EAAAA,EAAAA,IAAe,cA0GnBC,KAAKC,aAAaH,SAE3CI,EAAAA,EAAAA,YAAU,KACN,MAAMC,EA5EQC,MAClB,GAAIjC,EACA,OAAOA,EAEX,IAAKL,OACD,OAAO,KAGX,MAAM,qBAAEuC,GAAwBvC,OAChC,OAAKuC,GAILlC,EAAa,IAAIkC,GAAqBC,IAClC,IAAK,MAAMC,KAASD,EAAS,CACzB,MAAM,OAAE3B,EAAM,eAAE6B,EAAc,kBAAEC,GAAsBF,EAEzCC,GAAkBC,EAAoB,EAE/CjD,EAASmB,IAzBXlB,EA2BQkB,EA3BA+B,SACF,QAAhBA,EAAApD,EAAOqD,IAAIlD,UAAK,IAAAiD,GAAhBA,EAAkBE,QAClBtD,EAAOuD,OAAOpD,GA2BV,CA7BMA,MAAQiD,CA6Bd,IAEGvC,GAfI,IAeM,EAmDDiC,GACZ,IAAKD,EACD,OAGJ,MAAM,QAAEW,GAAYtB,EACpB,OAAKsB,GAGLX,EAAIY,QAAQD,GACL,IAAMX,EAAIa,UAAUF,SAJ3B,CAImC,GACpC,CAACtB,IAEJ,MAAMyB,EAjHOC,EAACpB,EAASH,KACvB,IAAKA,EAAM9B,KACP,OAAO,EAGX,MAAM,OAAEsD,EAAM,KAAEC,GAAS,IAAIxD,IAAI+B,EAAM9B,KAAMiC,GAC7C,OAAOsB,GAAQD,IAAWrB,GAAWH,EAAMhB,QAAUgB,EAAM0B,QAAQ,EA2GtDH,CAASpB,EAASH,GAC/B,OAAO2B,EAAAA,EAAAA,KAAA,KACI9C,QAASyC,EAAO,KAAOzC,EACvBW,aAAc8B,EAAO,KAAO9B,KACxBQ,EACJH,IAAKA,EAAIE,SAAEA,GAAa,EAGjC6B,GAAOC,EAAAA,EAAAA,YAAWlC,E","sources":["webpack://words-to-kick-your-teeth-out/./src/features/ui/a-client/index.jsx"],"sourcesContent":["import { useRef, useEffect, forwardRef } from \"react\";\nimport { graphql, useStaticQuery, prefetchPathname, navigate } from \"gatsby\";\nimport { interceptEnabled } from \"@features/intercept\";\n\nconst useSiteMetadataRaw = () => useStaticQuery(graphql`\nquery {\n  site {\n    siteMetadata {\n      siteUrl\n    }\n  }\n}`);\n\nconst fallback = (siteUrl, props) => {\n    if (!props.href) {\n        return true;\n    }\n\n    const { origin, hash } = new URL(props.href, siteUrl);\n    return hash || origin !== siteUrl || props.target || props.download;\n};\n\nconst aborts = new WeakMap();\n\nconst prefetch = elem => {\n    const { pathname, search } = new URL(elem.href, window.location);\n\n    const url = pathname + search;\n    aborts.set(elem, prefetchPathname(url));\n};\n\nconst abort = elem => {\n    aborts.get(elem)?.abort();\n    aborts.delete(elem);\n};\n\nlet prefetcher = null;\nconst getPrefetcher = () => {\n    if (prefetcher) {\n        return prefetcher;\n    }\n    if (!window) {\n        return null;\n    }\n\n    const { IntersectionObserver} = window;\n    if (!IntersectionObserver) {\n        return null;\n    }\n\n    prefetcher = new IntersectionObserver(entries => {\n        for (const entry of entries) {\n            const { target, isIntersecting, intersectionRatio } = entry;\n\n            const near = isIntersecting || intersectionRatio > 0;\n            if (near) {\n                prefetch(target);\n            } else {\n                abort(target);\n            }\n        }\n    });\n    return prefetcher;\n};\n\nconst bubble = e => {\n    while (e && (e.tagName !== 'A' || !e.href)) {\n        e = e.parentElement;\n    }\n    return e;\n};\n\nconst onClick = async e => {\n    if (interceptEnabled()) {\n        return;\n    }\n\n    const { target, altKey, metaKey, shiftKey, ctrlKey, button } = e;\n    if (button !== 0) {\n        return;\n    }\n\n    if (altKey || metaKey || shiftKey || ctrlKey) {\n        return;\n    }\n\n    e.preventDefault();\n\n    const { href } = bubble(target);\n    const { pathname, search } = new URL(href, window.location);\n\n    const url = pathname + search;\n\n    await navigate(url);\n};\n\nconst onMouseEnter = e => {\n    const { target } = e;\n    const { href } = bubble(target);\n    const { pathname, search } = new URL(href, window.location);\n    // FIXME\n    window.___loader.hovering(pathname + search);\n};\n\nconst AClient = ({children, ...props}, ref) => {\n    const theRef = useRef();\n    ref ??= theRef;\n\n    const metadata = useSiteMetadataRaw();\n\n    const siteUrl = metadata.site.siteMetadata.siteUrl;\n\n    useEffect(() => {\n        const pre = getPrefetcher();\n        if (!pre) {\n            return;\n        }\n\n        const { current } = ref;\n        if (!current) {\n            return;\n        }\n        pre.observe(current);\n        return () => pre.unobserve(current);\n    }, [ref]);\n\n    const fail = fallback(siteUrl, props);\n    return <a\n               onClick={fail ? null : onClick}\n               onMouseEnter={fail ? null : onMouseEnter}\n               {...props}\n               ref={ref}>{children}</a> ;\n};\n\nconst ARef = forwardRef(AClient);\n\nexport { ARef as AClient, ARef as default };\n"],"names":["aborts","WeakMap","prefetch","elem","pathname","search","URL","href","window","location","url","set","prefetchPathname","prefetcher","bubble","e","tagName","parentElement","onClick","async","interceptEnabled","target","altKey","metaKey","shiftKey","ctrlKey","button","preventDefault","navigate","onMouseEnter","___loader","hovering","AClient","_ref","ref","_ref2","children","props","theRef","useRef","siteUrl","useStaticQuery","site","siteMetadata","useEffect","pre","getPrefetcher","IntersectionObserver","entries","entry","isIntersecting","intersectionRatio","_aborts$get","get","abort","delete","current","observe","unobserve","fail","fallback","origin","hash","download","_jsx","ARef","forwardRef"],"sourceRoot":""}